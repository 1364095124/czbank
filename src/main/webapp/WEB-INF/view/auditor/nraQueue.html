<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>审核队列</title>
    <link href="../../css/bootstrap.modified.css" rel="stylesheet" type="text/css"/>
    <!--<link rel="stylesheet" href="../../layui/css/layui.css"/>-->


    <script src="../../js/jquery-1.11.0.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>

    <script src="../../js/hanlinCommons.js"></script>
    <!--<script src="../../layui/layui.all.js"></script>-->
    <script src="../../js/deferredAjax.js"></script>
    <style>
        .layui-form-switch{/* 解决layui与bootstrap的样式冲突 */
            height:25px!important;
            margin-top: 0px;
        }
        .hanlin-vertical-line{
            display: inline !important;
            border-right: solid 1px #c2c2c2;
            height: auto;
            margin: 0px 10px 0px 10px;
        }
    </style>
</head>
<body class="row">

<div class="col-lg-12 layui-form" lay-filter="controlForm" style="margin-top: 30px;">
    <label>拒绝申请询问：</label>
    <input id="askBeforeRefuse" type="checkbox" lay-filter="validatorSetting" name="null" lay-skin="switch" lay-text="开启|关闭" checked/>
    <div class="hanlin-vertical-line"></div>
    <label>申请通过询问：</label>
    <input id="askBeforePass" type="checkbox" lay-filter="validatorSetting" name="null" lay-skin="switch" lay-text="开启|关闭" checked/>
</div>
<div class="col-lg-12">
    <table id="queue" lay-filter="nra"></table>
</div>

<script>
$(document).ready(function (){
    layui.form.render();

    HanLin.request("c/getNraQueue", {}, function (data){
        data = JSON.parse(data);
        console.log(data);
        layui.table.render({
            elem: "#queue",
            title: "NRA队列",
            loading: true,
            //url: "/cManager/c/getQueueBetween",
            page: true,
            autoSort: false,
            cols: [[
                {field: 'queueNo', title: '-', width: 40, fixed: 'left'},
                {field: 'statusCode', title: '状态', width: 150, align: 'center',
                    templet: function (d){
                        switch (d.statusCode) {
                            case 0:
                                return "<p style='color: deepskyblue'>排队中</p>";
                            case 1:
                                return "<p style='color: #5eb95e'>审核通过</p>";
                            case 2:
                                return "<p style='color: red'>审核未通过</p>";
                        }
                    }
                },
                {title: '操作', width:140, align: 'center',
                    templet: function (d){
                        return "<button class='refuse btn btn-danger' nraFileId='"+d.id+"' uploadTime='"+d.uploadTime+"' fileName='"+d.fileName+"' style='height: 25px;line-height: 10px;'>拒绝</button> " +
                            "<button class='pass btn btn-success' nraFileId='"+d.id+"' uploadTime='"+d.uploadTime+"' fileName='"+d.fileName+"' style='height: 25px;line-height: 10px;'>通过</button>";

                    }
                },
                {field: 'fileName', title: '文件名(点击下载)', width:200,
                    templet: function (d){
                        return '<a target="_blank" href="c/downloadNraFile/'+d.id+'">'+d.fileName+'</a>';
                    }
                },
                {field: 'note', title: '备注', width: 200},
                {field: 'qualityCustomer', title: '优质客户', width:100, align: 'center',
                    templet: function (d){
                        return d.qualityCustomer?"<span class='glyphicon glyphicon-ok' style='color: #5eb95e;'</span>":"-";
                    }
                },
                {field: 'priority', title: '插队', width: 80, align: 'center',
                    templet: function (d){
                        return d.priority?"<span class='glyphicon glyphicon-ok' style='color: #5eb95e'></span>":"-";
                    }
                },
                {field: 'uploadTime', title: '上传时间', width:160, align: 'center'},
                {field: 'userName', title: '上传者', width: 120, align: 'center'},

                {field: 'id', title: 'ID', width:280},
            ]],
            toolbar: true,
            defaultToolbar: ["filter", "exports", "print"],
            data: data
        });


        $(document).on("click", ".refuse", function (e){
            var nraFileId = $(e.currentTarget).attr("nraFileId");
            var uploadTime = $(e.currentTarget).attr("uploadTime");
            var fileName = $(e.currentTarget).attr("fileName");
            var refuseIndex = layui.layer.confirm("是否拒绝申请：<br/>文件名:"+fileName+"<br/>上传时间:"+uploadTime+"", {
                title: "拒绝申请",
                btn: ['确定', '取消']
            }, function (){

                layer.close(refuseIndex);
            }, function (){
                layer.close(refuseIndex);
            });



        });
        $(document).on("click", ".pass", function (e){
            var nraFileId = $(e.currentTarget).attr("nraFileId");
            var uploadTime = $(e.currentTarget).attr("uploadTime");
            var fileName = $(e.currentTarget).attr("fileName");
            var passIndex = layui.layer.confirm("即将通过申请：<br/>文件名:"+fileName+"<br/>上传时间:"+uploadTime+"", {
                title: "申请通过",
                btn: ['确定', '取消']
            }, function (){


                layer.close(passIndex);
            }, function (){
                layer.close(passIndex);
            });


        });
    }, "获取NRA队列失败");



});
function pass(){
    HanLin.request("c/nraPass", {}, function (data){
        data = JSON.parse(data);
        if (data.flag){
            HanLin.success(data.message);
        } else {
            HanLin.error(data.message);
        }
    }, "更改nra文件状态为通过时请求服务器发生错误");
}
function refuse(){
    HanLin.request("c/nraRefuse", {}, function (data){
        data = JSON.parse(data);
        if (data.flag){
            HanLin.success(data.message);
        } else {
            HanLin.error(data.message);
        }
    }, "更改nra文件状态为拒绝时请求服务器发生错误");
}
</script>
</body>
</html>